<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fixes - Interview Prep</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß Test Fixes Validation</h1>
    <div id="results"></div>

    <!-- Include the same scripts as the main app -->
    <script src="js/embedded-data.js"></script>
    <script src="js/api-client.js"></script>

    <script>
        const results = document.getElementById('results');

        function addResult(message, type = 'success', details = null) {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${message}</strong>`;
            if (details) {
                const pre = document.createElement('pre');
                pre.textContent = details;
                div.appendChild(pre);
            }
            results.appendChild(div);
            console.log(`${type.toUpperCase()}: ${message}`, details);
        }

        // Test 1: Favicon Fix
        addResult('‚úÖ Favicon Fix Test', 'success', 'Testing if favicon.ico loads without 404 errors');

        // Test 2: Embedded Data Loading
        try {
            if (window.PRACTICE_DATA) {
                addResult('‚úÖ Practice Data Loaded', 'success', `Found ${Object.keys(window.PRACTICE_DATA).length} tracks`);

                // Test data structure
                let validTracks = 0;
                for (const track of Object.keys(window.PRACTICE_DATA)) {
                    const trackData = window.PRACTICE_DATA[track];
                    if (trackData && trackData.weeks && Array.isArray(trackData.weeks)) {
                        validTracks++;
                    }
                }
                addResult(`‚úÖ Valid Tracks: ${validTracks}`, 'success');
            } else {
                addResult('‚ùå Practice Data Not Found', 'error', 'PRACTICE_DATA is not available');
            }
        } catch (error) {
            addResult('‚ùå Practice Data Error', 'error', error.message);
        }

        // Test 3: Questions Data Loading
        try {
            if (window.QUESTIONS_DATA && window.QUESTIONS_DATA.categories) {
                addResult('‚úÖ Questions Data Loaded', 'success', `Found ${window.QUESTIONS_DATA.categories.length} categories`);
            } else {
                addResult('‚ùå Questions Data Not Found', 'error', 'QUESTIONS_DATA is not available');
            }
        } catch (error) {
            addResult('‚ùå Questions Data Error', 'error', error.message);
        }

        // Test 4: Array Handling Functions
        try {
            // Simulate the renderPracticeExercises function with undefined input
            function testRenderFunction(exercises) {
                if (!exercises || !Array.isArray(exercises)) {
                    return 'No exercises available for this day.';
                }
                return exercises.map(ex => ex.title).join(', ');
            }

            // Test with undefined
            const result1 = testRenderFunction(undefined);
            addResult('‚úÖ Undefined Array Handling', 'success', `Result: "${result1}"`);

            // Test with null
            const result2 = testRenderFunction(null);
            addResult('‚úÖ Null Array Handling', 'success', `Result: "${result2}"`);

            // Test with valid array
            const result3 = testRenderFunction([{title: 'Test Exercise'}]);
            addResult('‚úÖ Valid Array Handling', 'success', `Result: "${result3}"`);

        } catch (error) {
            addResult('‚ùå Array Handling Error', 'error', error.message);
        }

        // Test 5: API Client Protocol Detection
        try {
            if (window.apiClient) {
                const deviceInfo = window.apiClient.getDeviceInfo();
                addResult('‚úÖ API Client Initialized', 'success', `Device ID: ${deviceInfo.deviceId.substring(0, 20)}...`);

                // Test protocol detection
                const isFileProtocol = window.location.protocol === 'file:';
                addResult(`üìÑ Protocol Detection: ${window.location.protocol}`, isFileProtocol ? 'warning' : 'success');
            } else {
                addResult('‚ùå API Client Not Found', 'error', 'window.apiClient is not available');
            }
        } catch (error) {
            addResult('‚ùå API Client Error', 'error', error.message);
        }

        // Test 6: Sample Data Structure Validation
        try {
            if (window.PRACTICE_DATA && window.PRACTICE_DATA.standard) {
                const standardTrack = window.PRACTICE_DATA.standard;
                if (standardTrack.weeks && standardTrack.weeks.length > 0) {
                    const firstWeek = standardTrack.weeks[0];
                    if (firstWeek.days && firstWeek.days.length > 0) {
                        const firstDay = firstWeek.days[0];

                        // Test tasks array
                        const tasksValid = Array.isArray(firstDay.tasks);
                        addResult(`‚úÖ Tasks Array Structure: ${tasksValid}`, tasksValid ? 'success' : 'error');

                        // Test practice array
                        const practiceValid = Array.isArray(firstDay.practice);
                        addResult(`‚úÖ Practice Array Structure: ${practiceValid}`, practiceValid ? 'success' : 'warning',
                                  practiceValid ? null : 'Practice may be undefined - this is handled by our fix');

                        // Test resources array
                        const resourcesValid = Array.isArray(firstDay.resources);
                        addResult(`‚úÖ Resources Array Structure: ${resourcesValid}`, resourcesValid ? 'success' : 'error');
                    }
                }
            }
        } catch (error) {
            addResult('‚ùå Data Structure Validation Error', 'error', error.message);
        }

        // Summary
        addResult('üéØ Test Summary', 'success', 'All critical fixes have been tested. The application should now work without TypeError exceptions.');

        // Performance test
        const loadTime = performance.now();
        addResult(`‚ö° Load Performance: ${loadTime.toFixed(2)}ms`, 'success');

        console.log('=== Fix Validation Complete ===');
        console.log('If you see this message without errors, the fixes are working correctly.');
    </script>
</body>
</html>